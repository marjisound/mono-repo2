name: Run app

on:
  pull_request:
    branches:
      - master

jobs:
  validate:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: 12
    - uses: actions/cache@v2
      with:
        path: ~/.npm
        key: node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: node-    
    - name: install
      run: npm ci
    - name: run
      run: |
        npm install -g ngrok
        npm run watch & 
        ngrok http 8080 -log=stdout -host-header=rewrite &
      env: 
        APIS_IMG_SALT: ${{ secrets.APIS_IMG_SALT }}  
        CAPI_KEY: ${{ secrets.CAPI_KEY }}
    - name: sleep
      run: sleep 300s
          
